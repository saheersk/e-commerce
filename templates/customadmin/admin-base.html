<!DOCTYPE html>
<html lang="en">
    {% load static %}
    <!-- Mirrored from dashui.codescandy.com/dashuipro/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 11 Sep 2023 11:46:26 GMT -->
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="author" content="Codescandy" />

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-M8S4MT3EYG"></script>
        <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());

            gtag("config", "G-M8S4MT3EYG");
        </script>

        <!-- Favicon icon-->
        <link rel="shortcut icon" type="image/x-icon" href="{% static 'img/logo.png' %}" />

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
        <!-- Libs CSS -->
        <link href="{% static 'admin/libs/bootstrap-icons/font/bootstrap-icons.css' %}" rel="stylesheet" />
        {% comment %} <link href="{% static 'admin/libs/%40mdi/font/css/materialdesignicons.min.css' %}" rel="stylesheet" /> {% endcomment %}
        <link href="{% static 'admin/libs/simplebar/dist/simplebar.min.css' %}" rel="stylesheet" />

        <!-- Theme CSS -->
        <link href="{% static 'admin/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css' %}" rel="stylesheet" />
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        
        <link rel="stylesheet" href="{% static 'admin/css/theme.min.css' %}" />
        <link rel="stylesheet" href="{% static 'admin/css/style.css' %}" />
        <title>{{title}}</title>
        <style>
            .notification-panel {
                position: absolute;
                top: 100%; /* Position it below the icon */
                right: 80px; /* Adjust this value as needed for the horizontal position */
                background-color: #fff;
                border: 1px solid #ccc;
                display: none; /* Initially hide the panel */
                z-index: 999; /* Adjust the z-index as needed */
            }
            
            .notification-panel.show {
                display: block; /* Show the panel when the collapse class is added */
            }
            /* Style for notification links */
            .notification-content a {
                display: block;
                padding: 5px;
                text-decoration: none;
                color: #333; /* Text color */
            }
            
            .notification-content a:hover {
                background-color: #f5f5f5; /* Background color on hover */
            }
            .bell-icon-black {
                color: #000; /* Black color */
            }
        </style>
    </head>

    <body>
        {% block content %}{% endblock %}
        <!-- Scripts -->
        {{ room_name|json_script:"room-name" }}
        <!-- dropzone -->
        <script src="{% static 'admin/libs/dropzone/dist/min/dropzone.min.js' %}"></script>
        <!-- flatpickr -->
        <script src="{% static 'admin/libs/flatpickr/dist/flatpickr.min.js' %}"></script>

        <!-- quill js -->
        <script src="{% static 'admin/libs/quill/dist/quill.min.js' %}"></script>

        <!-- Libs JS -->
        <script src="{% static 'admin/libs/jquery/dist/jquery.min.js' %}"></script>
        <script src="{% static 'admin/libs/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
        <script src="{% static 'admin/libs/feather-icons/dist/feather.min.js' %}"></script>
        <script src="{% static 'admin/libs/simplebar/dist/simplebar.min.js' %}"></script>

        <!-- Theme JS -->
        <script src="{% static 'admin/js/theme.min.js' %}"></script>
        <script src="{% static 'admin/libs/apexcharts/dist/apexcharts.min.js' %}"></script>
        <script src="{% static 'admin/js/vendors/chart.js' %}"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
        <script src="{% static 'admin/js/script.js' %}"></script>
        <script>
            const roomName = JSON.parse(document.getElementById('room-name').textContent);
            console.log(roomName, 'room');
            
            const notificationSocket = new WebSocket(
                'ws://'
                + window.location.host
                + '/ws/notification/admin/'
                + 'admin'
                + '/'
            );
            
            notificationSocket.onmessage = function (e) {
                const data = JSON.parse(e.data);
                console.log(data, 'data');
            
                const orderItems = data.order_data.order_items;
                const orderItemsHTML = orderItems.map((orderItem) => `
                    <li>
                        <a href="/customadmin/order/orders/${orderItem.id}/">
                            <i class="fas fa-arrow-right me-2 text-primary"></i>${orderItem.product_title}
                        </a>
                    </li>
                `).join('');
            
                const notificationDropdown = document.getElementById("notification-dropdown");
                const newNotificationItem = document.createElement('li');
                newNotificationItem.className = 'list-group-item';
                newNotificationItem.innerHTML = `
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <span class="fw-bold mr-2">Username: ${data.full_name}</span>
                        </div>
                        <div>
                            <small class="text-muted">Total Amount: ${data.total_amount}</small>
                        </div>
                    </div>
                    <ul class="list-unstyled">
                        ${orderItemsHTML}
                    </ul>
                `;
            
                notificationDropdown.insertBefore(newNotificationItem, notificationDropdown.firstChild);
            
                document.getElementById("notification-badge").innerHTML = parseInt(document.getElementById("notification-badge").innerHTML) + 1;
            };
            
            notificationSocket.onclose = function(e) {
                console.error('Chat socket closed unexpectedly');
            };
        
            document.addEventListener("DOMContentLoaded", function () {
                const notificationIcon = document.querySelector(".notification-icon");
                const notificationContent = document.querySelector("#notification-panel");
                let notificationPanelOpen = false;
        
                notificationIcon.addEventListener("click", function () {
                    if (notificationPanelOpen) {
                        notificationContent.style.display = "none";
                        notificationPanelOpen = false;
                    } else {
                        notificationContent.style.display = "block";
                        notificationPanelOpen = true;
                    }
                });
            });
        </script>
    </body>
</html>
